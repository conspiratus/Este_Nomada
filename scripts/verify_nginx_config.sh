#!/usr/bin/expect -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx

set timeout 60
set server "administrator@85.190.102.101"
set password "Jovi4AndMay2020!"

puts "=========================================="
puts "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx"
puts "=========================================="

spawn ssh $server
expect {
    "password:" {
        send "$password\r"
    }
}

expect "administrator@*"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤–æ–∫—Ä—É–≥ location /api/ –∏ /chef/
puts "\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ location /api/ –∏ /chef/..."
send "sudo sed -n '129,180p' /etc/nginx/sites-available/estenomada\r"
expect "administrator@*"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—è–¥–æ–∫ location –±–ª–æ–∫–æ–≤
puts "\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—è–¥–∫–∞ location –±–ª–æ–∫–æ–≤..."
send "sudo grep -n 'location' /etc/nginx/sites-available/estenomada | grep -E '(api|chef|^[0-9]+:.*location /)' | head -10\r"
expect "administrator@*"

send "exit\r"
expect eof

