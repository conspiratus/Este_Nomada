{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block content %}
<div class="db-management">
    <h1>{{ title }}</h1>
    
    <!-- Информация о БД -->
    <div class="module">
        <h2>Информация о базе данных</h2>
        <table>
            <tr>
                <th>Тип БД:</th>
                <td>{{ db_info.engine }}</td>
            </tr>
            <tr>
                <th>Имя БД:</th>
                <td>{{ db_info.name }}</td>
            </tr>
            {% if not db_info.use_sqlite %}
            <tr>
                <th>Хост:</th>
                <td>{{ db_info.host }}:{{ db_info.port }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>Размер:</th>
                <td><strong>{{ db_info.size_mb }} MB</strong> ({{ db_info.size_bytes|floatformat:0 }} байт)</td>
            </tr>
        </table>
    </div>
    
    <!-- Таблицы -->
    <div class="module">
        <h2>Таблицы ({{ tables|length }})</h2>
        <table id="tables-list">
            <thead>
                <tr>
                    <th>Название таблицы</th>
                    <th>Количество записей</th>
                    {% if not db_info.use_sqlite %}
                    <th>Размер (MB)</th>
                    {% endif %}
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                {% for table in tables %}
                <tr>
                    <td><strong>{{ table.name }}</strong></td>
                    <td>{{ table.row_count|default:0 }}</td>
                    {% if not db_info.use_sqlite %}
                    <td>{{ table.size_mb|default:0|floatformat:2 }}</td>
                    {% endif %}
                    <td>
                        <a href="{% url 'admin:db_table_view' table.name %}" class="button">Просмотр</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">Таблицы не найдены</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Быстрые действия -->
    <div class="module">
        <h2>Быстрые действия</h2>
        <ul>
            <li><a href="{% url 'admin:db_backups' %}">Управление бэкапами</a></li>
            <li><a href="{% url 'admin:db_backup_create' %}" onclick="return confirm('Создать бэкап сейчас?');" style="display: inline-block; margin-top: 10px;">
                <form method="post" action="{% url 'admin:db_backup_create' %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="button">Создать бэкап</button>
                </form>
            </a></li>
        </ul>
    </div>
</div>

<style>
.db-management .module {
    margin-bottom: 20px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 15px;
}
.db-management table {
    width: 100%;
    border-collapse: collapse;
}
.db-management table th,
.db-management table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}
.db-management table th {
    background: #f5f5f5;
    font-weight: bold;
}
.db-management .button {
    display: inline-block;
    padding: 5px 15px;
    background: #417690;
    color: white;
    text-decoration: none;
    border-radius: 3px;
}
.db-management .button:hover {
    background: #205067;
}
</style>
{% endblock %}

