{% extends "chef/base.html" %}

{% block title %}Список блюд - Интерфейс повара{% endblock %}

{% block content %}
<div class="card">
    <h2>Все блюда</h2>
    
    <form method="get" action="{% url 'chef:dashboard' %}" class="search-form">
        <input type="text" name="search" placeholder="Поиск по названию..." 
               value="{{ search_query }}" style="flex: 1;">
        <select name="ttk_filter">
            <option value="all" {% if ttk_filter == 'all' %}selected{% endif %}>Все блюда</option>
            <option value="with_ttk" {% if ttk_filter == 'with_ttk' %}selected{% endif %}>С ТТК</option>
            <option value="without_ttk" {% if ttk_filter == 'without_ttk' %}selected{% endif %}>Без ТТК</option>
        </select>
        <button type="submit" class="btn">Поиск</button>
    </form>

    {% if dishes %}
    <div class="dish-grid">
        {% for dish in dishes %}
        <div class="dish-card">
            <h3>{{ dish.name }}</h3>
            <div class="category">{{ dish.category }}</div>
            {% if dish.description %}
            <p style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 1rem;">{{ dish.description|truncatewords:15 }}</p>
            {% endif %}
            
            {% if dish.active_ttk %}
            <span class="ttk-badge has-ttk">✓ ТТК доступна{% if dish.ttk_count > 1 %} ({{ dish.ttk_count }} версий){% endif %}</span>
            <div style="margin-top: 1rem;">
                <a href="{% url 'chef:dish_detail' dish.id %}" class="btn">Подробнее</a>
                <a href="{% url 'chef:ttk_view' dish.id dish.active_ttk.id %}" class="btn" style="margin-left: 0.5rem;">Просмотр ТТК</a>
            </div>
            {% else %}
            <span class="ttk-badge no-ttk">✗ ТТК отсутствует</span>
            <div style="margin-top: 1rem;">
                <a href="{% url 'chef:dish_detail' dish.id %}" class="btn">Подробнее</a>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <p>Блюда не найдены.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

