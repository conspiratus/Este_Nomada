# Применение миграций на сервере

Миграция для `MenuItemCategory` создана и закоммичена. Нужно применить её на сервере.

## Автоматическое применение (рекомендуется)

CI/CD автоматически применит миграции при следующем деплое из ветки `feature/personal-cabinet-cart`.

## Ручное применение

Если нужно применить миграции вручную:

```bash
# Подключись к серверу
ssh administrator@85.190.102.101

# Перейди в директорию проекта
cd /var/www/estenomada/backend

# Примени миграции
sudo -u www-data venv/bin/python manage.py migrate --noinput
```

Или используй скрипт:

```bash
# На локальной машине
ssh administrator@85.190.102.101 'bash -s' < scripts/apply_migrations.sh
```

## Что делает миграция

1. Создает таблицы:
   - `menu_item_categories` - категории блюд
   - `menu_item_category_translations` - переводы категорий

2. Изменяет таблицу `menu_items`:
   - Удаляет старый индекс на поле `category`
   - Изменяет поле `category` с `CharField` на `ForeignKey` (nullable)
   - Создает новый индекс на `category` и `active`

3. Изменяет таблицу `menu_item_translations`:
   - Удаляет поле `category` (теперь категория на уровне блюда, а не перевода)

## Важно

- Миграция безопасна: поле `category` в `MenuItem` сделано `nullable=True`, поэтому существующие записи не пострадают
- Перед применением миграции CI/CD автоматически создаст бэкап БД
- После применения миграции нужно будет создать категории в админке и назначить их блюдам

